---
title: "Data Visualization"
author: "Kemp Po"
output: 
  html_notebook:
    toc: yes
    toc_float: yes
  html_document:
    toc: yes
    df_print: paged
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Intro

This dashboard will cover several topics on R:

-   Reading data
-   Manipulating data
-   Creating visualizations using the `ggplot2` package

> At this point in time, use tidyverse packages Tidyverse includes the usual analytics packages like `ggplot2`, `dplyr`, `readr`, and many other packages that make our lives easier.

# Importing Data

## Flat files

### Text File

``` {r echo = TRUE}
write_lines("Hello World", "data/example.txt")
read_lines("data/example.txt")
```

### Comma Separated Values

```{r echo = TRUE}
library(readr)
write_csv(iris, "data/iris.csv")
read_csv("data/iris.csv", show_col_types = FALSE)
```

### Excel Files

```{r eval = FALSE}
library(readxl)
readxl::read_excel
```

## Databases (DBI)

```{r eval = FALSE}
library(DBI)
library(RPostgres)

dwh_conn <- db_connect(
    drv = Postgres(),
    host = Sys.getenv("DWH_HOST"),
    user = Sys.getenv("DWH_USER"),
    pass = Sys.getenv("DWH_PASS"),
    port = 5432,
    dbname = Sys.getenv("DWH_NAME")
)

dbGetQuery(
    conn = dwh_conn,
    statement = "SELECT * FROM dim_client limit 10"
)

dbExistsTable(
    conn = dwh_conn@con,
    name = "fact_trade_underwriting"
)

dbReadTable(
    conn = dwh_conn,
    name = "fact_fx_rate"
)

dbListTables(
    conn = dwh_conn
)

library(dbx)
library(tibble)

dbDisconnect(
    conn = dwh_conn
)
```

### Databases (ORM)

```{r eval = FALSE}
library(dbplyr)
library(dplyr)

tbl(dwh_conn, "dim_client") %>% 
    select(revenue_estimate) %>% 
    filter(is.na(revenue_estimate)) %>% 
    collect(n = Inf) 
```

## Web APIs

```{r echo=TRUE}
library(httr)
library(dplyr)
library(jsonlite)

GET(
    url = "http://api.exchangeratesapi.io/v1/",
    path = "latest",
    query = list(access_key = Sys.getenv("FX_API_KEY"))
) %>% 
    stop_for_status() %>% 
    content(as = "parsed") ->
    response

response$rates$USD
```

## Google Sheets

# Data manipulation

```{r echo = TRUE}
data <- read_csv("data/country vaccinations.csv", show_col_types = FALSE)

data %>% 
  filter(country == "Philippines")
```

```{r echo = TRUE}

```

# Visualization
